#if !INITRD
#define INITRD

#include "ramdisk.ika"
#include "panic.ika"
#include "vfs.ika"

var rd0: RamDisk;
var rd0_bd: BlockDevice;

var initrd_sb: *SuperBlock;

fn initrd_mount(info: *BootInfo) void {
    if (info.module_count == 0) {
        panic("No initrd");
    }

    rd_init(&rd0, &rd0_bd, info.modules[0].start, info.modules[0].end);
    if (vfs_mount(&rd0_bd, "ext2", &initrd_sb) != 0) {
        panic("Failed to mount initrd");
    }
}

#endif
